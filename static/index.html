<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BEEP - Система записи в автосервис</title>
    <link rel="stylesheet" href="/static/style/style.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeLoginModal()">&times;</span>
                <h2>Вход в систему</h2>
            </div>
            <div class="modal-body">
                <div id="loginError" class="error" style="display: none;"></div>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="modalEmail">Email</label>
                        <input type="email" id="modalEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="modalPassword">Пароль</label>
                        <input type="password" id="modalPassword" required>
                    </div>
                    <button type="submit" class="btn-primary">Войти</button>
                </form>
                <div class="divider" id="dividerOr" style="display: flex; align-items: center; justify-content: center; gap: 10px; margin: 20px 0;">
                    <span style="flex: 1; height: 1px; background: #e2e8f0;"></span>
                    <span style="color: #999;">или</span>
                    <span style="flex: 1; height: 1px; background: #e2e8f0;"></span>
                </div>
                <button class="btn-secondary" id="btnCreateAccount" onclick="showRegisterForm()">Создать аккаунт</button>
                
                <!-- Register Form (hidden by default) -->
                <div id="registerForm" style="display: none; margin-top: 20px;">
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="regName">Имя</label>
                            <input type="text" id="regName" required>
                        </div>
                        <div class="form-group">
                            <label for="regEmail">Email</label>
                            <input type="email" id="regEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="regPhone">Телефон</label>
                            <input type="tel" id="regPhone">
                        </div>
                        <div class="form-group">
                            <label for="regPassword">Пароль</label>
                            <input type="password" id="regPassword" required>
                        </div>
                        <button type="submit" class="btn-primary" style="margin-top: 10px;">Зарегистрироваться</button>
                        <button type="button" class="btn-secondary" onclick="hideRegisterForm()" style="margin-top: 10px; width: auto; display: block; margin-left: auto; margin-right: auto;">Войти</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div style="flex: 1; display: flex; align-items: center; gap: 15px;">
                    <a href="/"><img src="/static/logo.png?v=3&t=1730123456" alt="BEEP" style="width: 60px; height: 60px;"></a>
                    <div>
                        <h1 style="margin: 0;">BEEP</h1>
                        <p class="tagline" style="margin: 0;">Система записи в автосервис</p>
                    </div>
                </div>
                <button onclick="openLoginModal()" style="padding: 15px 30px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 30px; font-weight: 600; font-size: 24px; cursor: pointer; box-shadow: 0 2px 12px rgba(102, 126, 234, 0.3); white-space: nowrap; min-width: auto; width: auto; margin-right: 50px;">Войти</button>
            </div>
        </header>

        <div class="main-content">
            <div class="card">
                <h2>Выберите услугу</h2>
                
                <div class="form-group">
                    <label for="category">Категория</label>
                    <select id="category" onchange="loadServices()">
                        <option value="">Выберите категорию...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="service">Услуга</label>
                    <select id="service" onchange="loadCars()">
                        <option value="">Выберите услугу...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="car">Автомобиль</label>
                    <select id="car">
                        <option value="">Выберите автомобиль...</option>
                    </select>
                </div>

                <button onclick="calculatePrice()">Рассчитать цену</button>
            </div>

            <div class="card">
                <h2>Выберите мастера и время</h2>
                
                <div class="form-group">
                    <label for="master-dropdown">Мастер</label>
                    <div class="custom-dropdown" id="master-dropdown">
                        <div class="dropdown-header" onclick="toggleMasterDropdown()">
                            <span id="selected-master">Выберите мастера...</span>
                            <span class="arrow">▼</span>
                        </div>
                        <div class="dropdown-body" id="master-dropdown-body" style="display: none;">
                            <div class="dropdown-search" style="display: flex; gap: 8px; margin-bottom: 10px; align-items: center;">
                                <input type="text" id="master-search" placeholder="Поиск мастеров..." onkeyup="filterMasters()" style="flex: 1; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; width: 100%;">
                                <button id="favoritesFilterBtn" onclick="toggleFavoritesFilter()" style="padding: 8px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" title="Показать только избранные">⭐</button>
                                <button id="verifiedFilterBtn" onclick="toggleVerifiedFilter()" style="padding: 8px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; width: auto; min-width: 50px; height: 36px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: 600;" title="Показать только проверенных мастеров">Пров.</button>
                            </div>
                            <div id="masters-container" class="masters-grid-dropdown">
                                <div class="loading">Загрузка мастеров...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <label for="appointment-date" style="display: block; margin-bottom: 8px;">Дата</label>
                    <input type="date" id="appointment-date" onchange="updateTimeSlots()" required>
                </div>

                <div style="margin-top: 15px;">
                    <label for="appointment-time" style="display: block; margin-bottom: 8px;">Время</label>
                    <select id="appointment-time">
                        <option value="">Выберите время...</option>
                    </select>
                </div>

                <div style="margin-top: 15px;">
                    <label for="comment" style="display: block; margin-bottom: 8px;">Комментарий (необязательно)</label>
                    <textarea id="comment" rows="3" placeholder="Любые особые указания..."></textarea>
                </div>

                <button onclick="bookAppointment()" style="margin-top: 20px;">Записаться</button>
            </div>
        </div>

        <!-- (4) Закомментировано для будущего использования: Поиск мастеров поблизости (14.) -->
        <!--
        <div class="card" style="margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Карта мастеров</h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="getUserLocation()" style="padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">📍 Моё местоположение</button>
                    <button onclick="clearMapLocation()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Очистить</button>
                </div>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px;">Радиус поиска (км):</label>
                <input type="range" id="radius-slider" min="1" max="50" value="10" oninput="updateRadius(this.value)" style="width: 100%;">
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="font-size: 12px; color: #64748b;">1 км</span>
                    <span id="radius-value" style="font-weight: 600; color: var(--primary);">10 км</span>
                    <span style="font-size: 12px; color: #64748b;">50 км</span>
                </div>
            </div>
            <div id="map" style="height: 500px; width: 100%; border-radius: 12px; border: 2px solid #e2e8f0;"></div>
            <div style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid var(--primary);">
                <p style="margin: 0; color: #334155; font-size: 14px;">
                    <strong>💡 Подсказка:</strong> Кликните на карте, чтобы выбрать местоположение для поиска мастеров поблизости. 
                    Или используйте кнопку "Моё местоположение" для автоматического определения вашего местоположения.
                </p>
            </div>
        </div>
        -->

        <div class="results" id="results" style="display: none;">
            <h2>Результаты</h2>
            <div id="results-content"></div>
        </div>

        <div class="card" style="margin-top: 30px;">
            <h2>Мои записи</h2>
            <button onclick="loadMyAppointments()">Просмотреть мои записи</button>
            <div id="appointments-list" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script src="/static/script/script.js"></script>
</body>
</html>


